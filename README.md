# aru-raharja-backend

Rust backend starter using **Actix Web + Diesel (PostgreSQL)**.  
Goals: simple health endpoint, DB pool, and auto-migrations on startup.

## Why `.cargo/config.toml` exists

On Windows/MSVC, the PostgreSQL client library (**libpq**) and headers (**libpq-fe.h**) must be discoverable **at compile time** (for Diesel’s Postgres backend).  
We commit `.cargo/config.toml` so **Cargo always knows where libpq is** without re-exporting env vars every time.


> If you build on Linux/WSL/CI, adjust/remove these as needed, or provide a platform-specific config.

---

## Requirements

- Rust (stable, MSVC toolchain on Windows)
- PostgreSQL (running locally)
- Diesel CLI (for migrations/schema generation)

---

## Quick start

### 1) Environment variables

Copy `.env.example` → `.env` and set your values:

```dotenv
DATABASE_URL=postgres://postgres:PASSWORD@localhost:PORT/DBNAME?sslmode=disable
APP_HOST=127.0.0.1
APP_PORT=8080
RUST_LOG=info
```

### 2) Start PostgreSQL (Windows)

```powershell
# Find service name (usually postgresql-x64-17)
Get-Service | findstr postgresql

# Start service
net start postgresql-x64-17

# Verify listening port
netstat -ano | findstr PORT
```

Create the DB if needed:

```powershell
psql -U postgres -h localhost -p PORT -d postgres -c 'CREATE DATABASE "DBNAME";'
```

### 3) Install Diesel CLI (one time)

```powershell
cargo install diesel_cli --no-default-features --features postgres
diesel --version
```

### 4) Diesel setup & schema

```powershell
diesel setup
diesel migration run
# IMPORTANT (Windows): ensure schema.rs is UTF-8
diesel print-schema | Out-File -Encoding utf8 src\schema.rs
```

### 5) Run

```powershell
cargo run
```

---

## Hot reload (dev)

```powershell
cargo install cargo-watch
cargo watch -x run
```

---

## Project layout

```
src/
  config/        # env config loader
  db/            # pool + embedded migrations
  routes/        # HTTP endpoints
  models/        # data models (structs for DB tables, API requests/responses, serialization)
  schema.rs      # generated by Diesel (UTF-8)
.cargo/config.toml
build.rs            # auto-link libpq (Windows)
diesel.toml
migrations/
.env
```

---

## Notes

On **Windows**, `build.rs` + `.cargo/config.toml` handle `libpq` paths automatically.  
